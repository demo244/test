@Bean
public SecurityFilterChain configure(HttpSecurity http) throws Exception {
    

    http.addFilterBefore(new ClientSecretValidationFilter(requestUtils, journeyLog),
                         AnonymousAuthenticationFilter.class);

  
    http.addFilterAfter(new MessageTypeValidationFilter(requestUtils, journeyLog),
                        ClientSecretValidationFilter.class);

    http
        .cors(AbstractHttpConfigurer::disable)
        .csrf(AbstractHttpConfigurer::disable)
        .httpBasic(Customizer.withDefaults())
        .formLogin(AbstractHttpConfigurer::disable)

        .authorizeHttpRequests(auth -> auth
            .requestMatchers(new AntPathRequestMatcher("/actuator/**")).permitAll()
            .anyRequest().authenticated()
        )

        .sessionManagement(session -> session
            .sessionCreationPolicy(SessionCreationPolicy.STATELESS)
        );

    return http.build();
}
