import org.springframework.batch.item.ItemReader;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

public class TimedItemReader<T> implements ItemReader<T> {

    private final ItemReader<T> delegate;
    private boolean logged = false;
    private static final Logger logger = LoggerFactory.getLogger(TimedItemReader.class);

    public TimedItemReader(ItemReader<T> delegate) {
        this.delegate = delegate;
    }

    @Override
    public T read() throws Exception {
        long start = System.currentTimeMillis();
        T item = delegate.read();
        long end = System.currentTimeMillis();

        if (!logged) {
            logger.info("Initial DB query and cursor opening took {} ms", (end - start));
            logged = true;
        }

        return item;
    }
}
